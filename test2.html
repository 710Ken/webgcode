<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>webgcode test</title>

    <script src="assets/x3dom.js"></script>
    <script src="assets/jquery.min.js"></script>
    <script src="assets/jquery.flot.min.js"></script>
    <script src="geometry.js"></script>
    <script src="simulation.js"></script>
    <script src="parser.js"></script>
    <link rel="stylesheet" href="assets/x3dom.css">
    <style>
        .chart {
            position: relative;
            clear: both;
            width: 100%;
            height: 200px;
        }

        X3D, x3d {
            float: right;
            width: 100%;
            height: 600px;
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
<h1>Testing raster</h1>
<x3d id="x3d" xmlns="http://www.x3dom.org/x3dom" showStat="false" showLog="false" x="0px" y="0px">
    <Scene id="scene" DEF='scene'>
        <Shape id="xaxis">
            <Appearance>
                <Material emissiveColor='1 0 0'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 10.0 0.0 0.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='11 0 0'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='1 0 0'/>
                </Appearance>
                <text string='X' style="BOLD"></text>
            </Shape>
        </transform>
        <Shape id="yaxis">
            <Appearance>
                <Material emissiveColor='0 1 0'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 0.0 10.0 0.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='0 11 0'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='0 1 0'/>
                </Appearance>
                <text string='Y' style="BOLD"></text>
            </Shape>
        </transform>
        <Shape id="zaxis">
            <Appearance>
                <Material emissiveColor='0 0 1'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 0.0 0.0 10.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='0 0 11'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='0 0 1'/>
                </Appearance>
                <text string='Z' style="BOLD"></text>
            </Shape>
        </transform>
    </Scene>
</x3d>

<script>
    var text = "G1 X30 F1000\nG3 Y20 J10";
    x3dom.runtime.ready = (function () {
        function quadrant(angle) {
            return (Math.floor(angle / (Math.PI / 2) + 0.5) % 4 + 4) % 4;
        }

        var AXES = ['x', 'y', 'z'];
        var testLine = {
            feedRate: 3000,
            from: {x: 0, y: 0, z: 0},
            to: {x: 5, y: 5, z: 5},
            type: "line"};
        var testArc = {
            angularDistance: -Math.PI,
            center: {
                first: 0,
                second: 0
            },
            feedRate: 1000,
            from: { x: 0, y: 0, z: 0},
            fromAngle: -Math.PI / 2,
            plane: {
                firstCoord: "x",
                lastCoord: "z",
                secondCoord: "y"
            },
            radius: 30,
            to: {x: 60, y: 0, z: 0},
            type: "arc"
        };

        window.addEventListener("message", function (event) {
            console.log(event);
            if (event.data['type'] == 'gimme program') {
                event.source.postMessage({type: 'program', program: planProgram(text, 200, 1 / 640, 200000).program}, event.origin);
            }
        }, false);

        var prgm = planProgram(text, 200, 1 / 640, 200000);
        console.log(prgm.program);
        displayPath(prgm.path, '0 0 0', 'toolpath');
        $('#x3d')[0].runtime.showAll();
    });
</script>
</body>
</html>